# System Design социальной сети для путешественников

### Легенда
У бизнеса **есть четкое понимание функциональности**, которая эта социальная сеть должна будет предоставлять в будущем:

- публикация постов из путешествий с фотографиями, небольшим описанием и привязкой к конкретному месту путешествия;
- оценка и комментарии постов других путешественников;
- подписка на других путешественников, чтобы следить за их активностью;
- поиск популярных мест для путешествий и просмотр постов с этих мест;
- просмотр ленты других путешественников и ленты пользователя, основанной на подписках в обратном хронологическом порядке;

> Что касается будущей аудитории социальной сети - у бизнеса есть огромные средства для рекламы и продвижения социальной сети, поэтому пользовательская база будет постепенно линейно расти и предполагается, что через год достигнет примерно 10 000 000 уникальных пользователей в день, после чего также будет продолжать расти. Бизнес пока нацелен только на аудиторию стран СНГ (_на зарубежный рынок выходить планов нет_). Будущая система должна быть очень надежной, а также, чтобы с ней было удобно взаимодействовать, используя мобильные устройства и браузер.

### Функциональные требования
- Публикация постов
	- Возможность указать небольшое описание поста
	- Возможность добавления фотографий к посту
	- Возможность проставления геоточки поста
- Просмотр постов
	- Сортировка в обратном хронологическом порядке (всегда)
	- Общая лента на главной (специфичная для каждого пользователя, по подпискам)
	- Просмотр ленты конкретного путешественника
	- Просмотр постов по конкретному месту
- Оценка постов
- Комментирование постов
- Поиск мест для путешествий (и тут же должна быть кнопка для просмотра постов по этому месту)
- Подписка на других путешественников, для отслеживания активности

### Нефункциональные требования
- DAU 10_000_000 в перспективе года с ожидаемым ростом
- В среднем пользователь:
	- просматривает:
		- 30 постов
		- 40 комментариев, 
	- Делает:
		- лайкает 5 постов, 
		- оставляет 1 комментарий
		- подписывается на 1 пользователя
		- пост раз в 5 дней.
- В среднем пост содержит 500 символов и одну фотографию
- Объем комментария 500 символов
- Макс размер фотографии 500кб
- Аудитория СНГ
- Сезонной нагрузки нет
- Данные храним всегда
- На пользователя может подписаться неограниченное количество человек
- Пользователь должен видеть новый пост в общей ленте в течении минуты после публикации и в ленте автора - почти сразу
- стабильность 99.99%

### Расчет нагрузки

##### Посты
RPS чтение = 10_000_000 * 30 / 86400 = 3500 RPS
RPS запись = 10_000_000 * 1/5(постов в день) / 86400 = 23RPS

Data TX = 3500 * 500(символов) * 2(вес символа) = 3_500_000байт/с = 3,5мб/с
Data RX = 23 * 500(символов) * 2(вес символа) = 23_000байт/с=23кб/с

Photo TX = 3500 * 500(кб) = 1_750_000кб/с = 2гб/с
Photo RX = 23 * 500(кб) = 11_500кб/с = 12мб/с

Объем данных за год:
Data = 23кб/с * 86400 * 365 = 725гб
Photo = 12мб/с * 86400 * 365 = 378тб
##### Комментарии
RPS чтение = 10_000_000 * 40 / 86400 = 4700 RPS
RPS запись = 10_000_000 * 1 / 86400 = 115RPS

Data TX = 4700 * 500(символов) * 2(вес символа) = 4_700_000б/с = 4,7мб/с
Data RX = 115 * 500(символов) * 2(вес символа) = 115_000б/с = 115кб/с

Объем данных за год:
115кб/с * 86400 * 365 = 3.7тб

##### Лайки
RPS чтение = 10_000_000 * 30 / 86400 = 3500 RPS
RPS запись = 10_000_000 * 5 / 86400 = 600RPS

Запись 1 лайка = user_id + post_id + datetime = 16 + 16 + 8 = 40 байт
Data TX = 3500 * 40 = 140_000байт/с = 140кб/с
Data RX = 600 * 40 = 1200байт/с=1,2кб/с

Объем данных за год:
1,2кб/с * 86400 * 365 = 38гб

#### Итог по расчету памяти
Для понимания будущего capacity:
На год мы получим примерно:
- В СУБД 725гб+3700гб+38гб=4,5 тб 
- В S3 378ТБ

Учитывая, что нагрузка далее будет расти линейно, но скорее всего будет падать из-за объективных усложнений увеличения DAU, можно предположить, что через 5 лет в год мы будем прибавлять:
- В СУБД 15тб
- В S3 1000ТБ

Для первых 5 лет понадобится хранилища на:
- В СУБД (15+4,5) / 2 * 5=50ТБ
- В S3 (1000+378) / 2 * =3500ТБ

